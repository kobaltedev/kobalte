import { Preview, TabsSnippets, Kbd } from "../../../../components";
import {
	BasicExample,
	DefaultValueExample,
	ControlledExample,
	HalfRatingsExample,
	DescriptionExample,
	ErrorMessageExample,
	HTMLFormExample,
} from "../../../../examples/rating-group";

# Rating Group

Allows users to rate items using a set of icons.

## Import

```ts
import { RatingGroup } from "@kobalte/core/rating-group";
// or
import { Root, Label, ... } from "@kobalte/core/rating-group";
```

## Features

- Syncs with form reset events.
- Group and rating labeling support for assistive technology.
- Can be controlled or uncontrolled.

## Anatomy

The rating group consists of:

- **RatingGroup**: The root container for the rating group.
- **RatingGroup.Control**: The container for the rating items.
- **RatingGroup.Label**: The label that gives the user information on the rating group.
- **RatingGroup.Input**: The native html input that is visually hidden in the rating group.
- **RatingGroup.Description**: The description that gives the user more information on the rating group.
- **RatingGroup.ErrorMessage**: The error message that gives the user information about how to fix a validation error on the rating group.

The rating item consists of:

- **RatingGroup.Item**: The root container for a rating item.
- **RatingGroup.ItemControl**: The element that visually represents a rating item.
- **RatingGroup.ItemLabel**: The label that gives the user information on the rating item.
- **RatingGroup.ItemDescription**: The description that gives the user more information on the rating item.

```tsx
<RatingGroup>
	<RatingGroup.Label />
	<RatingGroup.Control>
        <RatingGroup.Item>
            <RatingGroup.ItemControl />
            <RatingGroup.ItemLabel />
            <RatingGroup.ItemDescription />
        </RatingGroup.Item>
    <RatingGroup.Control>
	<RatingGroup.Input />
	<RatingGroup.Description />
	<RatingGroup.ErrorMessage />
</RatingGroup>
```

## Example

<Preview>
	<BasicExample />
</Preview>

<TabsSnippets>
  <TabsSnippets.List>
    <TabsSnippets.Trigger value="index.tsx">index.tsx</TabsSnippets.Trigger>
    <TabsSnippets.Trigger value="style.css">style.css</TabsSnippets.Trigger>
  </TabsSnippets.List>
  {/* <!-- prettier-ignore-start --> */}
  <TabsSnippets.Content value="index.tsx">
    ```tsx
	import { RatingGroup } from "@kobalte/core/rating-group";
    import "./style.css";

    function App() {
      return (
        <RatingGroup count={5} class="rating-group">
    		<RatingGroup.Label class="rating-group__label">
    			Rating:
    		</RatingGroup.Label>
    		<RatingGroup.Control class="rating-group__control">
    			{({ items }) => (
    				<For each={items}>
    					{(item) => (
    						<RatingGroup.Item index={item} class="rating-group-item">
    							<RatingGroup.ItemControl>
    								<StarIcon />
    							</RatingGroup.ItemControl>
    						</RatingGroup.Item>
    					)}
    				</For>
    			)}
    		</RatingGroup.Control>
    	</RatingGroup>
      );
    }
    ```

  </TabsSnippets.Content>
  <TabsSnippets.Content value="style.css">
```css
.rating-group {
	display: flex;
	flex-direction: column;
	gap: 8px;
}

.rating-group\_\_label {
color: hsl(240 6% 10%);
font-size: 14px;
font-weight: 500;
user-select: none;
}

.rating-group\_\_description {
color: hsl(240 5% 26%);
font-size: 12px;
user-select: none;
}

.rating-group\_\_error-message {
color: hsl(0 72% 51%);
font-size: 12px;
user-select: none;
}

.rating-group\_\_control {
display: flex;
gap: 4px;
}

.rating-group-item {
cursor: pointer;
fill: hsl(240 6% 90%);
transition: fill 200ms cubic-bezier(0.2, 0, 0, 1);
}

.rating-group-item[data-highlighted] {
fill: hsl(200 98% 39%);
}

````

  </TabsSnippets.Content>
  {/* <!-- prettier-ignore-end --> */}
</TabsSnippets>

## Usage

### Default value

An initial, uncontrolled value can be provided using the `defaultValue` prop.

<Preview>
	<DefaultValueExample />
</Preview>

```tsx
<RatingGroup defaultValue={2.5} count={5} >
			<RatingGroup.Label>
				Rating:
			</RatingGroup.Label>
			<RatingGroup.Control>
				{({ items }) => (
					<For each={items}>
						{(item) => (
							<RatingGroup.Item index={item}>
								<RatingGroup.ItemControl>
									<StarIcon />
								</RatingGroup.ItemControl>
							</RatingGroup.Item>
						)}
					</For>
				)}
			</RatingGroup.Control>
		</RatingGroup>
````

### Controlled value

The `value` prop can be used to make the value controlled. The `onChange` event is fired when the user selects a rating, and receives the new value.

<Preview>
	<ControlledExample />
</Preview>

```tsx
import { createSignal } from "solid-js";

function ControlledExample() {
	const [value, setValue] = createSignal(0);

	return (
		<RatingGroup
				count={5}
				value={value()}
				onChange={setValue}
			>
				<RatingGroup.Label>
					Rating:
				</RatingGroup.Label>
				<RatingGroup.Control>
					{({ items }) => (
						<For each={items}>
							{(item) => (
								<RatingGroup.Item
									index={item}
								>
									<RatingGroup.ItemControl>
										<StarIcon />
									</RatingGroup.ItemControl>
								</RatingGroup.Item>
							)}
						</For>
					)}
				</RatingGroup.Control>
			</RatingGroup>
			<p class="not-prose text-sm mt-4">Your rating is: {value()}/5</p>
		</>
	);
}
```

### Half Ratings

Allow 0.5 value steps by setting the `allowHalf` prop to true.

<Preview>
	<HalfRatingsExample />
</Preview>

```tsx
<RatingGroup count={5} allowHalf>
	<RatingGroup.Control>
		{({ items }) => (
			<For each={items}>
				{item => (
					<RatingGroup.Item index={item}>
						<RatingGroup.ItemControl>
							{state =>
								state.half ? <StarHalfIcon /> : state.highlighted ? <StarIcon /> : <StarIcon />
							}
						</RatingGroup.ItemControl>
					</RatingGroup.Item>
				)}
			</For>
		)}
	</RatingGroup.Control>
</RatingGroup>
```

### Description

The `RatingGroup.Description` component can be used to associate additional help text with a rating group.

<Preview>
	<DescriptionExample />
</Preview>

```tsx
<RatingGroup count={5}>
	<RatingGroup.Label>Rating:</RatingGroup.Label>
	<RatingGroup.Control>
		{({ items }) => (
			<For each={items}>
				{item => (
					<RatingGroup.Item index={item}>
						<RatingGroup.ItemControl>
							<StarIcon />
						</RatingGroup.ItemControl>
					</RatingGroup.Item>
				)}
			</For>
		)}
	</RatingGroup.Control>
	<RatingGroup.Description>Rate your experience with us.</RatingGroup.Description>
</RatingGroup>
```

### Error message

The `RatingGroup.ErrorMessage` component can be used to help the user fix a validation error. It should be combined with the `validationState` prop to semantically mark the rating group as invalid for assistive technologies.

By default, it will render only when the `validationState` prop is set to `invalid`, use the `forceMount` prop to always render the error message (ex: for usage with animation libraries).

<Preview>
	<ErrorMessageExample />
</Preview>

```tsx
import { createSignal } from "solid-js";

function ErrorMessageExample() {
	const [value, setValue] = createSignal(0);

	return (
		<RatingGroup
			count={5}
			value={value()}
			onChange={setValue}
			validationState={value() === 0 ? "invalid" : "valid"}
		>
			<RatingGroup.Label>Rating:</RatingGroup.Label>
			<RatingGroup.Control>
				{({ items }) => (
					<For each={items}>
						{item => (
							<RatingGroup.Item index={item}>
								<RatingGroup.ItemControl>
									<StarIcon />
								</RatingGroup.ItemControl>
							</RatingGroup.Item>
						)}
					</For>
				)}
			</RatingGroup.Control>
			<RatingGroup.ErrorMessage>Please select a rating between 1 and 5.</RatingGroup.ErrorMessage>
		</RatingGroup>
	);
}
```

### HTML forms

The `name` prop can be used for integration with HTML forms.

<Preview>
	<HTMLFormExample />
</Preview>

```tsx {7,19}
function HTMLFormExample() {
	let formRef: HTMLFormElement | undefined;

	const onSubmit = (e: SubmitEvent) => {
		e.preventDefault();
		e.stopPropagation();

		const formData = new FormData(formRef);

		alert(JSON.stringify(Object.fromEntries(formData), null, 2));
	};

	return (
		<form ref={formRef} onSubmit={onSubmit}>
			<RatingGroup count={5} name="rate">
				<RatingGroup.Control>
					{({ items }) => (
						<For each={items}>
							{item => (
								<RatingGroup.Item index={item}>
									<RatingGroup.ItemControl>
										<StarIcon />
									</RatingGroup.ItemControl>
								</RatingGroup.Item>
							)}
						</For>
					)}
				</RatingGroup.Control>
				<RatingGroup.Input />
			</RatingGroup>
			<div class="flex space-x-2">
				<button type="reset" class="kb-button">
					Reset
				</button>
				<button type="submit" class="kb-button-primary">
					Submit
				</button>
			</div>
		</form>
	);
}
```

## API Reference

### RatingGroup

`RatingGroup` is equivalent to the `Root` import from `@kobalte/core/Rating-group`.

| Prop            | Description                                                                                                                                        |
| :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| value           | `number` <br/> The current rating value.                                                                                                           |
| defaultValue    | `number` <br/> The initial value of the rating group when it is first rendered. Use when you do not need to control the state of the rating group. |
| onChange        | `(value: number) => void` <br/> Event handler called when the value changes.                                                                       |
| allowHalf       | `boolean` <br/> Whether to allow half ratings.                                                                                                     |
| count           | `number` <br /> count of items.                                                                                                                    |
| orientation     | `'horizontal' \| 'vertical'` <br/> The axis the rating group items should align with.                                                              |
| name            | `string` <br/> The name of the rating group. Submitted with its owning form as part of a name/value pair.                                          |
| validationState | `'valid' \| 'invalid'` <br/> Whether the rating group should display its "valid" or "invalid" visual styling.                                      |
| required        | `boolean` <br/> Whether the user must select an item before the owning form can be submitted.                                                      |
| disabled        | `boolean` <br/> Whether the rating group is disabled.                                                                                              |
| readOnly        | `boolean` <br/> Whether the rating group items can be selected but not changed by the user.                                                        |

| Data attribute | Description                                                                                    |
| :------------- | :--------------------------------------------------------------------------------------------- |
| data-valid     | Present when the rating group is valid according to the validation rules.                      |
| data-invalid   | Present when the rating group is invalid according to the validation rules.                    |
| data-required  | Present when the user must select a rating group item before the owning form can be submitted. |
| data-disabled  | Present when the rating group is disabled.                                                     |
| data-readonly  | Present when the rating group is read only.                                                    |

`RatingGroup.Label`, `RatingGroup.Description` and `RatingGroup.ErrorMesssage` shares the same data-attributes.

### RatingGroup.ErrorMessage

| Prop       | Description                                                                                                                             |
| :--------- | :-------------------------------------------------------------------------------------------------------------------------------------- |
| forceMount | `boolean` <br/> Used to force mounting when more control is needed. Useful when controlling animation with SolidJS animation libraries. |

### RatingGroup.Item

| Render Prop | Description                                 |
| :---------- | :------------------------------------------ |
| index       | `boolean` <br/> Unique value/index of item. |

### RatingGroup.ItemControl

| Render Prop | Description                                             |
| :---------- | :------------------------------------------------------ |
| half        | `boolean` <br/> Whether the rating item is half.        |
| highlighted | `boolean` <br/> Whether the rating item is highlighted. |

| Data attribute   | Description                                                                        |
| :--------------- | :--------------------------------------------------------------------------------- |
| data-valid       | Present when the parent rating group is valid according to the validation rules.   |
| data-invalid     | Present when the parent rating group is invalid according to the validation rules. |
| data-required    | Present when the parent rating group is required.                                  |
| data-disabled    | Present when the parent rating group is disabled.                                  |
| data-readonly    | Present when the parent rating group is read only.                                 |
| data-checked     | Present when the rating is checked.                                                |
| data-half        | Present when the rating is half.                                                   |
| data-highlighted | Present when the rating is highlighted.                                            |

`RatingGroup.ItemLabel` and `RatingGroup.ItemDescription` share the same data-attributes.

## Rendered elements

| Component                     | Default rendered element |
| :---------------------------- | :----------------------- |
| `RatingGroup`                 | `div`                    |
| `RatingGroup.Control`         | `div`                    |
| `RatingGroup.Label`           | `span`                   |
| `RatingGroup.Input`           | `input`                  |
| `RatingGroup.Description`     | `div`                    |
| `RatingGroup.ErrorMessage`    | `div`                    |
| `RatingGroup.Item`            | `div`                    |
| `RatingGroup.ItemControl`     | `div`                    |
| `RatingGroup.ItemLabel`       | `label`                  |
| `RatingGroup.ItemDescription` | `div`                    |
